events {

}

http {
	upstream mentee_upstream {
		server mentee_service:80;
	}

	upstream mentee_ssl_upstream {
		server mentee_service:443;
	}

	upstream mentor_upstream {
		server mentor_service:80;
	}

	upstream mentor_ssl_upstream {
		server mentor_service:443;
	}

	include 				/etc/nginx/mime.types;

	server {
		listen 		    	80;
		listen					[::]:80;

		server_name 		nginx.gateway www.nginx.gateway;

		location /mentee {
			rewrite 		^/mentee/(.*) /$1 break;
			proxy_pass 		http://mentee_upstream/$1;
		}

		location /mentor {
			rewrite 		^/mentor/(.*) /$1 break;
			proxy_pass 		http://mentor_upstream/$1;
		}
	}

	server {
		listen					443;
		listen					[::]:443;

		ssl on;
		ssl_certificate 			/var/www/cert/nginx-selfsigned.crt;
		ssl_certificate_key		/var/www/cert/nginx-selfsigned.key;
		ssl_session_timeout		3m;
		add_header 						Strict-Transport-Security "max-age=7200";

		server_name 		nginx.gateway www.nginx.gateway;

		location /mentee {
			rewrite 		^/mentee/(.*) /$1 break;
			proxy_pass 		http://mentee_upstream/$1;
		}

		location /mentor {
			rewrite 		^/mentor/(.*) /$1 break;
			proxy_pass 		http://mentor_upstream/$1;
		}
	}
}